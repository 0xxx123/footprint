<!DOCTYPE html>\n<html lang=\"zh\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>粒子动画与访问计数</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n            background-color: black;\n            overflow: hidden;\n            width: 100%;\n            height: 100vh;\n            height: 100dvh;\n        }\n        \n        canvas {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            touch-action: none;\n        }\n        \n        .footer-text {\n            position: fixed;\n            bottom: 20px;\n            left: 50%;\n            transform: translateX(-50%);\n            color: rgba(255, 255, 255, 0.5);\n            font-size: 14px;\n            text-align: center;\n            z-index: 1;\n            pointer-events: auto;\n        }\n\n        .footer-text a {\n            color: rgba(255, 255, 255, 0.5);\n            text-decoration: none;\n            transition: color 0.3s ease;\n        }\n\n        .footer-text a:hover {\n            color: #00f50c;\n        }\n    </style>\n</head>\n<body>\n    <canvas id=\"particleCanvas\" aria-label=\"Interactive particle effect\"></canvas>\n    <div class=\"footer-text\"><a href=\"https://x.com/fei_sheepsheep\" target=\"_blank\">X：@fei_sheepsheep</a></div>\n    <script>\n        document.addEventListener('DOMContentLoaded', () => {\n            const canvas = document.getElementById('particleCanvas');\n            const ctx = canvas.getContext('2d');\n            \n            let mousePosition = { x: 0, y: 0 };\n            let isTouching = false;\n            let isMobile = false;\n            let particles = [];\n            let textImageData = null;\n            let animationFrameId;\n            let visitorCount = '0000';  // 初始化访问者数量\n\n            // 获取访问者数量\n            async function fetchVisitorCount() {\n                try {\n                    const response = await fetch('/visitor');\n                    const data = await response.json();\n                    // 将数字格式化为4位数，不足前面补0\n                    visitorCount = String(data.count).padStart(4, '0');\n                    // 重新创建文字图像和粒子\n                    const newScale = createTextImage();\n                    particles = [];\n                    createInitialParticles(newScale);\n                } catch (error) {\n                    console.error('Error fetching visitor count:', error);\n                }\n            }\n\n            function updateCanvasSize() {\n                canvas.width = window.innerWidth;\n                canvas.height = window.innerHeight;\n                isMobile = window.innerWidth < 768;\n            }\n\n            updateCanvasSize();\n\n            function createTextImage() {\n                if (!ctx || !canvas) return 0;\n\n                ctx.fillStyle = 'white';\n                ctx.save();\n                \n                const fontSize = isMobile ? 120 : 160;\n                const lineHeight = fontSize * 1.2;\n                ctx.font = `bold ${fontSize}px -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto`;\n                ctx.textAlign = 'center';\n                \n                // Draw all text lines\n                const lines = ['You are', `NO. ${visitorCount}`];\n                const centerY = canvas.height / 2 - (lines.length - 1) * lineHeight / 2;\n                \n                lines.forEach((line, index) => {\n                    ctx.fillText(line, canvas.width / 2, centerY + index * lineHeight);\n                });\n                \n                textImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n                ctx.clearRect(0, 0, canvas.width, canvas.height);\n                \n                ctx.restore();\n                return fontSize / 100;\n            }\n\n            function createParticle(scale) {\n                if (!ctx || !canvas || !textImageData) return null;\n\n                const data = textImageData.data;\n\n                for (let attempt = 0; attempt < 100; attempt++) {\n                    const x = Math.floor(Math.random() * canvas.width);\n                    const y = Math.floor(Math.random() * canvas.height);\n\n                    if (data[(y * canvas.width + x) * 4 + 3] > 128) {\n                        const isSecondLine = y > canvas.height / 2;\n                        return {\n                            x: x,\n                            y: y,\n                            baseX: x,\n                            baseY: y,\n                            size: Math.random() * 1 + 0.5,\n                            color: 'white',\n                            scatteredColor: isSecondLine ? '#ff4db8' : '#22d3ee',\n                            life: Math.random() * 100 + 50\n                        };\n                    }\n                }\n\n                return null;\n            }\n\n            function createInitialParticles(scale) {\n                const baseParticleCount = 4000;\n                const particleCount = Math.floor(baseParticleCount * Math.sqrt((canvas.width * canvas.height) / (1920 * 1080)));\n                for (let i = 0; i < particleCount; i++) {\n                    const particle = createParticle(scale);\n                    if (particle) particles.push(particle);\n                }\n            }\n\n            function animate(scale) {\n                if (!ctx || !canvas) return;\n                ctx.clearRect(0, 0, canvas.width, canvas.height);\n                ctx.fillStyle = 'black';\n                ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n                const { x: mouseX, y: mouseY } = mousePosition;\n                const maxDistance = 240;\n\n                for (let i = 0; i < particles.length; i++) {\n                    const p = particles[i];\n                    const dx = mouseX - p.x;\n                    const dy = mouseY - p.y;\n                    const distance = Math.sqrt(dx * dx + dy * dy);\n\n                    if (distance < maxDistance && (isTouching || !('ontouchstart' in window))) {\n                        const force = (maxDistance - distance) / maxDistance;\n                        const angle = Math.atan2(dy, dx);\n                        const moveX = Math.cos(angle) * force * 60;\n                        const moveY = Math.sin(angle) * force * 60;\n                        p.x = p.baseX - moveX;\n                        p.y = p.baseY - moveY;\n                        \n                        ctx.fillStyle = p.scatteredColor;\n                    } else {\n                        p.x += (p.baseX - p.x) * 0.1;\n                        p.y += (p.baseY - p.y) * 0.1;\n                        ctx.fillStyle = p.color;\n                    }\n\n                    ctx.fillRect(p.x, p.y, p.size, p.size);\n\n                    p.life--;\n                    if (p.life <= 0) {\n                        const newParticle = createParticle(scale);\n                        if (newParticle) {\n                            particles[i] = newParticle;\n                        } else {\n                            particles.splice(i, 1);\n                            i--;\n                        }\n                    }\n                }\n\n                const baseParticleCount = 4000;\n                const targetParticleCount = Math.floor(baseParticleCount * Math.sqrt((canvas.width * canvas.height) / (1920 * 1080)));\n                while (particles.length < targetParticleCount) {\n                    const newParticle = createParticle(scale);\n                    if (newParticle) particles.push(newParticle);\n                }\n\n                animationFrameId = requestAnimationFrame(() => animate(scale));\n            }\n\n            function handleMove(x, y) {\n                mousePosition = { x, y };\n            }\n\n            function handleMouseMove(e) {\n                handleMove(e.clientX, e.clientY);\n            }\n\n            function handleTouchMove(e) {\n                if (e.touches.length > 0) {\n                    e.preventDefault();\n                    handleMove(e.touches[0].clientX, e.touches[0].clientY);\n                }\n            }\n\n            function handleTouchStart() {\n                isTouching = true;\n            }\n\n            function handleTouchEnd() {\n                isTouching = false;\n                mousePosition = { x: 0, y: 0 };\n            }\n\n            function handleMouseLeave() {\n                if (!('ontouchstart' in window)) {\n                    mousePosition = { x: 0, y: 0 };\n                }\n            }\n\n            function handleResize() {\n                updateCanvasSize();\n                const newScale = createTextImage();\n                particles = [];\n                createInitialParticles(newScale);\n            }\n\n            // Initialize\n            fetchVisitorCount().then(() => {\n                const scale = createTextImage();\n                createInitialParticles(scale);\n                animate(scale);\n            });\n\n            // Event listeners\n            window.addEventListener('resize', handleResize);\n            canvas.addEventListener('mousemove', handleMouseMove);\n            canvas.addEventListener('touchmove', handleTouchMove, { passive: false });\n            canvas.addEventListener('mouseleave', handleMouseLeave);\n            canvas.addEventListener('touchstart', handleTouchStart);\n            canvas.addEventListener('touchend', handleTouchEnd);\n        });\n    </script>\n</body>\n</html>